# ğŸš€ Next Update & Feature Implementation Plan

This document outlines the upcoming tasks, considerations, and improvements to implement in the next update.  
It is organized by domain:

- âš™ï¸ Mini Service  
- ğŸ³ Deployment (Docker)  
- ğŸ“‚ S3 File Management  
- ğŸ”’ Security Policies  
- ğŸ’° Cost Management  

---

## âš™ï¸ Mini Service

### ğŸ”§ Service Management
- **Implement mini service and mini store logic**  
  - Create a dedicated **mini service layer**.  
  - Implement a **mini store** to persist mini service states.  
  - Add a **lock mechanism** when retrieving or updating data to ensure consistency.  

- **Service status locks**  
  - Maintain a lock status per service to decide if it is **usable or blocked**.  
  - Ensure service status reflects **DB states** (e.g., profile state).  
  - Build a **decorator** to validate service usability in resources.  
  - Optionally add **caching** for faster access.  

- **Dependency graph of services**  
  - Maintain a set of dependencies between services.  
  - Represent this as a **service dependency graph**.  
  - Allow each service to know which other services depend on it.  

### ğŸ› ï¸ Decorator Improvements
- **Service dependency behavior**  
  - Enhance decorators to define **dependency levels** between services.  
  - Configure **reload behavior**:  
    - Should the service **rebuild**?  
    - At which stage?  
    - Or simply **ignore** and continue?  
  - Allow decorators to dynamically **change service status** based on dependencies.  

### ğŸ‘¤ Profile & Worker Integration
- **Profile data retrieval**  
  - Design a flexible way to **retrieve profile data**, adaptable to **Celery workers**.  

### ğŸ“¦ Mini Store & Container
- **Mini store completion**  
  - Finalize the mini store logic.  
  - Create a **mini container** that:  
    - Links service management and deletion.  
    - Maintains references to mini services.  

- **Stream channel management**  
  - Enable **pause, resume, create, delete, and purge** operations on stream channels.  
  - Define whether these are managed as **mini services**.  
  - Ensure behavior is **delegated to the profile service**.  

### ğŸ§© Example Scenario
- If **HashiCorp Vault (HC Vault)** fails temporarily:  
  - **Secrets service** and **JWT service** should remain available.  
  - **Mongoose** and **Postgres** services may be marked as unavailable.  

---

## ğŸ³ Deployment (Docker)

### ğŸŒ Networking & Security
- **Monitoring subnet**  
  - Create a subnet for monitoring containers.  
  - Allow secure access via **tunnels**.  

- **DMZ (Demilitarized Zone)**  
  - Deploy the **landing page** inside a DMZ for security.  

- **Docker API integration**  
  - Implement a **Docker API** for container and resource management.  

- **Network setup**  
  - Complete the **Docker networks** design and configuration.  

- **Secrets & volumes security**  
  - Configure **Docker secrets** properly.  
  - Audit **cross-mounted volumes** for security compliance.  

### ğŸ”„ Flexibility
- Ensure deployment allows for **server availability flexibility**.  

---

## ğŸ“‚ S3 File Management

### ğŸ“ Volume Strategy
- Each container must mount an **assets volume**.  
  - If no S3 is required â†’ mount the **base assets directory**.  
  - If S3 is required â†’ mount the **S3 container volume**.  

### ğŸ–¼ï¸ Asset Management
- Provide a dedicated **asset manager image** with capabilities to:  
  - ğŸ“¤ Upload  
  - ğŸ“¥ Download  
  - ğŸ—‘ï¸ Delete  
  - ğŸ“ƒ List  

### ğŸ”” Syncing & Notifications
- **Serverless integration**  
  - Implement a serverless function to **sync app database** with S3.  
  - The function will:  
    1. âœ… Validate **permissions** against the app.  
    2. ğŸ“¦ Forward requests to **S3**.  
    3. ğŸ”„ Send a **syncing notification** to update app memory.  

---

## ğŸ”’ Security Policies

### ğŸ“œ Policy Management
- **Decouple JWT secrets from access policies**.  
- Store and manage **policies per client or group**.  
- Policies should cover:  
  - ğŸ‘¤ Profiles  
  - ğŸ“‚ Assets  
  - ğŸŒ Routes  

### ğŸ›¡ï¸ Policy Behavior
- On resource deletion â†’ ensure related **policies are removed**.  
- Implement **policy decorators** for permission checks.  

### ğŸ” Additional Security
- Limit the number of tokens a client can generate.  
- Lock middleware when **policies are being updated**.  
  - This could itself be managed as a **mini service**.  

---

## ğŸ’° Cost Management

### â³ Rate Limiting
- Mount a **rate-limit JSON** configuration file.  

### ğŸ’¸ Refund Mechanism
- Implement a **refund system** for specific requests (e.g., failed or unnecessary processing).  

---
